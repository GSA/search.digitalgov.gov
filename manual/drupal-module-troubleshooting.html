<!DOCTYPE html>
<html lang="en">
<head>
  <meta name=viewport content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>Drupal Module Troubleshooting Tips</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,700" media="screen" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" media="screen" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,700" media="screen" rel="stylesheet" type="text/css" />
  <link href="/bootstrap/css/bootstrap.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/font-awesome.min.css">
  <!--[if IE 7]>
  <link rel="stylesheet" href="/stylesheets/font-awesome-ie7.min.css">
  <![endif]-->

  <!--<link href="../assets/css/bootstrap-responsive.css" rel="stylesheet">-->
  <link href="/stylesheets/custom.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
  <script src="/javascripts/html5shiv.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <!--  <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
          href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
          href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
  <link rel="shortcut icon" href="https://d3qcdigd1fhos0.cloudfront.net/blog/img/favicon.ico">
  <link rel='alternate' type='application/atom+xml' title='usasearch.howto.gov Atom feed' href='/all.atom' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="/javascripts/bootstrap3-typeahead.js"></script>
<!-- Back Soon! — https://github.com/GSA/back-soon -->
<script type="text/javascript">

  url = "search.gov";

  msg="<p><strong><span>Due to a lapse in government funding</span>, the "+url+" site and regular customer support will be unavailable until further notice.</strong> The Search.gov search system will remain operational and maintained.</p><p class='bs_usa'>Updates regarding government operating status and resumption of normal operations can be found at <a href='https://usa.gov' title='https://usa.gov'>usa.gov</a>.</p>",window.onload=function(){document.body.innerHTML+="<div id='bs'><div>"+msg+"<a href='#' title='Close' id='bs_close'>Continue to "+url+" »</a></div></div>"},document.onclick=function(n){"bs"!=n.target.id&&"bs_close"!=n.target.id||(bs.style.display="none")};</script>
<style media="screen">#bs{background:#000;opacity:.8;width:100%;height:100%;position:absolute;top:0;left:0;right:0;bottom:0}#bs div{position:absolute;top:1.5em;left:0;right:0;margin:0 auto;padding:2em 2em 2.5em;background:#fff;width:90%;box-sizing:border-box;color:#000;font-family:Helvetica,Arial,sans-serif}#bs span{background:#FFC116}#bs a{color:blue}#bs_close{margin-top:15px;padding:10px 15px;border:2px solid blue;display:inline-block;font-weight:700}#bs p{margin-top:0;font-size:24px;line-height:30px}#bs .bs_usa{font-size:18px;line-height:24px}@media only screen and (min-width: 600px){#bs div{padding:2.5em 2.5em 3em;top:5em;width:600px}}</style>

</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="/">
        <span class="search">Search.gov</span>
      </a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

      <form class="navbar-form navbar-left form-search" accept-charset="UTF-8" action="https://find.search.gov/search/" id="search-form" method="get">
        <div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
        <input name="affiliate" id="affiliate" type="hidden" value="usasearch">
        <div class="input-group input-append">
          <label for="search-query" class="hide">Query</label>

          <input name="query" autocomplete="off"  type="text" class="typeahead form-control search-query" id="search-query" data-provide="typeahead" >
          <span class="input-group-btn">
            <button type="submit" class="btn btn-nav" aria-label="Left Align" id="search-button">
              <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            </button>
          </span>
        </div>
      </form>
      <div class="nav navbar-right">
          <a href="https://search.usa.gov/sites" class="navbar-brand"><i
              class="icon-user icon-white"></i>&nbsp;Login</a>
      </div>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>


<div class="col-md-offset-2 col-md-8  hidden-sm hidden-md hidden-lg">

  <form class="form-search" accept-charset="UTF-8" action="https://find.search.gov/search/" id="search-form" method="get">
    <input name="affiliate" id="affiliate" type="hidden" value="usasearch">
    <div class="input-group input-append">
      <label for="search-query" class="hide">Query</label>

      <input name="query" autocomplete="off"  type="text" class=" form-control search-query" id="search-query"  >
      <span class="input-group-btn">
        <button type="submit" class="btn btn-primary" aria-label="Left Align" id="search-button">
          <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
        </button>
      </span>
    </div>
  </form>
</div>


<div class="container-fluid">
  <div class="col-md-8 col-md-offset-2">
    <!-- do not remove as used to parse in usasearch -->
    <div id="main-container">    
      <article class="article feature" style="padding:0 30px; margin-top: 10px;">
  
  <h1>
    <a href="/manual/drupal-module-troubleshooting.html">Drupal Module Troubleshooting Tips</a>
  </h1>
  

  <div class='post-content'>
    <p>If you have installed the <code>usasearch</code> <a href="https://drupal.org/project/usasearch">Drupal module</a> <i class="icon-external-link"><span>(External link)</span></i> to integrate your Drupal CMS with the Search.gov service but are having trouble, the following suggestions should help you identify where the problem is. If after working through these items you still have questions, <a href="mailto:search@support.digitalgov.gov">reach out to our team</a> and, though we’re not Drupal experts, we can try to help.</p>

<p><a href="#search-errors">Skip to Search error troubleshooting tips</a></p>

<h2 id="indexing-errors">Indexing errors</h2>

<h3 id="do-you-have-the-right-module-for-your-drupal-version">Do you have the right module for your Drupal version?</h3>

<p>We have modules for both Drupal 7 and Drupal 8. If your site is in Drupal 7, use <code>usasearch-7.x-5.7</code>. If your site is in Drupal 8, click <a href="https://www.drupal.org/project/usasearch/releases">View all Releases</a> <i class="icon-external-link"><span>(External link)</span></i> and select API version <code>8.x</code>.</p>

<h3 id="have-you-set-up-an-i14y-drawer">Have you set up an i14y drawer?</h3>

<p>In order to send content from Drupal to our system, you’ll need an index to send the content into. We call these indexes “Drawers”, because like drawers in a filing cabinet, all the items put into them will be the content you can search against. <a href="/manual/i14y-drawers.html">Read more about Drawers here</a>. In order to set up a drawer, your search site will need to be enabled for i14y, so <a href="mailto:search@support.digitalgov.gov">contact us</a> to request that.</p>

<h3 id="has-any-content-actually-been-sent-to-us">Has any content actually been sent to us?</h3>

<p>The module sends content when someone hits <code>save</code> on a node, or when you run <code>re-index site</code>. In Drupal 7, <code>re-index site</code> is found on the main Drupal search settings page (<code>YOUR-DRUPAL-SITE.gov/admin/config/search/settings</code>); in Drupal 8, you can re-index the site from the bottom of the module settings page.</p>

<ul>
  <li>If these actions have indeed happened, check the Drupal recent log messages (<code>YOUR-DRUPAL-SITE.gov/admin/reports/dblog</code>) to see if there’s anything related to <code>usasearch</code>, and please <a href="mailto:search@support.digitalgov.gov">send us screenshots of the errors</a>.</li>
  <li>If these actions haven’t yet happened, please hit <code>save</code> on a node, and see if that item appears in your Drawer. You can view the contents of your Drawer by selecting <a href="https://search.usa.gov/sites">Search Admin Center</a> &gt; Your site &gt; Content &gt; i14y Drawers &gt; Show. If the item isn’t there, then check the Drupal log for an error.</li>
</ul>

<h3 id="is-your-firewall-letting-you-communicate-with-us">Is your firewall letting you communicate with us?</h3>

<p>If content isn’t reaching us, it could be that your firewall is not allowing you to reach i14y. Please run the following from the command line, from inside the same firewall as your web server, if possible. Note: you’ll need to customize the string below with your i14y drawer’s handle and secret token (where it says <code>YOURDRAWERHANDLE:YOURDRAWERSECRETTOKEN</code>):</p>

<pre><code>curl "https://i14y.usa.gov/api/v1/documents" -XPOST -H "Content-Type:application/json" -u YOURDRAWERHANDLE:YOURDRAWERSECRETTOKEN -d '{"document_id":"1", "title":"test item", "created":"2017-02-16T10:19:02", "path":"https://www.usa.gov", "description":"This is a test", "content":"This is a test to see if the agency web server is able to communicate with the i14y API. If this document does not show up in the drawer in the admin center, then the i14y location may need to be whitelisted in order to facilitate indexing."}'
</code></pre>

<ul>
  <li>
    <p>If you get a <code>403 Forbidden</code> response</p>

    <p>Please contact your security team to request the i14y hostname be whitelisted: <code>https://i14y.usa.gov/</code></p>

    <p>We can’t give you an IP to whitelist, as our system is hosted in AWS, and so i14y’s IP address changes regularly.</p>
  </li>
  <li>
    <p>If you get a <code>200 OK</code> response</p>

    <p>Your system is able to communicate with our system, so the issue must lie in how the module is working with your Drupal instance. <a href="mailto:search@support.digitalgov.gov">Send us</a> all the information and screenshots of errors that you can, and we’ll help you troubleshoot.</p>

    <p>Be sure you delete the test document or it will be included in your search results. You can delete it from the command line. Run this command:</p>

    <pre><code>curl "https://i14y.usa.gov/api/v1/documents/1" -XDELETE -u YOURDRAWERHANDLE:YOURDRAWERSECRETTOKEN
</code></pre>
  </li>
  <li>
    <p>If you get any other error response</p>

    <p>Please take a screenshot and <a href="mailto:search@support.digitalgov.gov">send it to us</a> to report the issue so we can investigate the error.</p>
  </li>
</ul>

<h3 id="do-you-have-another-question">Do you have another question?</h3>

<p>If you have another question about indexing with our service through the <code>usasearch</code> Drupal module, <a href="mailto:search@support.digitalgov.gov">don’t hesitate to ask</a>!</p>

<p><a name="search-errors"></a></p>

<h2 id="search-errors">Search errors</h2>

<h3 id="is-your-drupal-site-search-box-showing-drupal-search-results">Is your Drupal site search box showing Drupal search results?</h3>

<ul>
  <li>
    <p>If you have a <strong>Drupal 7</strong> site</p>

    <p>Our Drupal 7 module is designed to take over the native Drupal search box on your site, and direct queries to the site you specify in the <code>affiliate site handle</code> field. If you’re seeing other results - either the Drupal search results or a different search site in our system, find out if the search box form code had been manually modified to point to this other location. Our module will only work with out-of-the-box Drupal search boxes. If the search box form code was modified, you’ll need to manually point it to our service using the required parameters - you can see <a href="/manual/code.html">general information on form code here</a>, or you can view examples customized to your particular site within the Admin Center, under <code>Activate</code>. You may also be able to restore the form code to the Drupal default, to take advantage of the module’s site handle field and be able to modify the site handle without a dev.</p>
  </li>
  <li>
    <p>If you have a <strong>Drupal 8</strong> site</p>

    <p>In Drupal 8, we don’t override the native Drupal search box. Instead, you need to place a <code>USA Search Form</code> block, and disable the default Drupal search. To do this, go to <code>YOUR-DRUPAL-SITE.gov/admin/structure/block</code> in your Drupal site, and do <code>ctrl-F</code> to locate the word <code>Search</code> in the list. Disable the block that says just <code>Search</code>. Use <code>Place block</code> to insert a <code>USA Search Form</code> block in the block region of your choice. The search box in this block will point at the search site you entered in the module settings.</p>
  </li>
</ul>

<h3 id="is-the-drupal-site-search-box-directing-to-the-wrong-searchgov-site">Is the Drupal site search box directing to the wrong Search.gov site?</h3>

<p>Your search box should use the site handle you entered on the module settings page. If you run a search and are brought to our search results page, but see the wrong search site, check to see if the Drupal search box form code was manually modified to point to another search site handle (the <code>affiliate</code> parameter in the form code). If it was modified, you’ll need to change the site handle directly in that modified code. You may also be able to restore the form code to the Drupal default, to take advantage of the module’s site handle field and be able to modify the site handle without a developer.</p>

<h3 id="do-you-have-another-question-1">Do you have another question?</h3>

<p>If you have another question about searching through our service with the <code>usasearch</code> Drupal module, <a href="mailto:search@support.digitalgov.gov">don’t hesitate to ask</a>!</p>

  </div>

  <div class='tags'>
    
    <a href="/tagged/drupal,"><span class="label label-info">drupal,</span></a>
    
    <a href="/tagged/i14y"><span class="label label-info">i14y</span></a>
    
  </div>

  <div class='time'>
    
    
    
    
    <a href="/manual/drupal-module-troubleshooting.html">
      <time>August 25, 2017</time>
    </a>
  </div>

</article>
      
    </div>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p><a href="mailto:search@support.digitalgov.gov">Email us</a> or call us at 202-505-5315</p>
    <p> An Official Website of the U.S. Government <br />
      <a href="https://www.gsa.gov/portal/category/25729">Technology Transformation Service</a>, <a href="https://www.gsa.gov/portal/category/100000">U.S. General Services Administration</a>
    </p>
    <ul class="footer-links list-unstyled list-inline">
      <li><a href="https://www.usa.gov">USA.gov</a></li>
      <li class="muted">&bull;</li>
      <li><a href="/tos.html">Terms of Service</a></li>
      <li class="muted">&bull;</li>
      <li><a href="https://www.digitalgov.gov/about/policies/">Site Policies</a></li>
      <li class="muted">&bull;</li>
      <li><a href="/developer/">Developers</a></li>
    </ul>
  </div>
</footer>

<script type="text/javascript">
  //<![CDATA[
  var usasearch_config = { siteHandle:"usasearch" };

jQuery(document).ready(function() {
  $('.typeahead').typeahead({
      source: function (query, process) {
          return $.get('https://search.usa.gov/sayt?name=usasearch&q=' + query, function (data) {
              return process(data);
          });
      }, minLength: 2
  });
})


  // var script = document.createElement("script");
  // script.type = "text/javascript";
  // script.src = "https://search.usa.gov/javascripts/remote.loader.js";
  // document.getElementsByTagName("head")[0].appendChild(script);

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31302465-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  //]]>
</script>

<script async type="text/javascript" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=GSA" id="_fed_an_ua_tag"></script>


</body>
</html>
